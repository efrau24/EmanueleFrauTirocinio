version: "3.1"

rules:

# greeting rules

- rule: Greet after form completion
  condition:
    - slot_was_set:
        - form_completed: true
  steps:
    - intent: greet
    - action: utter_personalized_greeting

- rule: Respond to goodbye
  steps:
    - intent: goodbye
    - action: utter_goodbye

# form rules

- rule: User info form completion
  condition:
    - active_loop: user_info_form
  steps:
    - action: user_info_form
    - active_loop: null
    - slot_was_set:
        - requested_slot: null
    - action: action_submit_user_info_form


- rule: Extract user name 
  steps:
    - intent: user_name
    - action: action_extract_name


- rule: Classify user occupation
  steps:
    - intent: inform_occupation
    - action: action_classify_user_occupation

- rule: Classify user interests
  steps:
    - intent: inform_interests
    - action: action_classify_user_interests

- rule: Classify user health condition
  steps:
    - intent: inform_health_condition
    - action: action_classify_user_health_condition

- rule: Classify user lifestyle
  steps:
    - intent: inform_lifestyle
    - action: action_classify_user_lifestyle


- rule: User refuses to provide information
  steps:
    - intent: reject
    - action: utter_ok_no_questions

# conversation rules

- rule: Respond to thank you
  steps:
    - intent: thank_you
    - action: utter_you_are_welcome

- rule: Respond_to_ask_about_chatbot
  steps:
    - intent: ask_about_chatbot
    - action: utter_info

# custom action rules

- rule: Classify topic from generic message
  steps:
    - intent: generic_message
    - action: action_classify_topic

- rule: LLM fallback if not classifiable
  steps:
    - intent: nlu_fallback
    - action: action_llm_fallback

- rule: Classify talk type
  steps:
    - intent: mi_message
    - action: action_classify_talk_type
