version: "3.1"

rules:

# greeting rules

- rule: Greet after form completion
  condition:
    - slot_was_set:
        - form_completed: true
  steps:
    - intent: greet
    - action: utter_personalized_greeting

- rule: Respond to goodbye
  steps:
    - intent: goodbye
    - action: utter_goodbye

# form rules

- rule: User info form completion
  condition:
    - active_loop: user_info_form
  steps:
    - action: user_info_form
    - active_loop: null
    - slot_was_set:
        - requested_slot: null
    - action: action_submit_user_info_form

# Mood Form
- rule: Salva i dati del mood form
  condition:
    - active_loop: mood_form
  steps:
    - action: mood_form
    - active_loop: null
    - action: action_save_issue_profile
    - action: action_submit_issue_form
    - action: action_ask_focus_issue
    - action: action_update_personality



# Sleep form
- rule: Salva i dati del sleep form
  condition:
    - active_loop: sleep_form
  steps:
    - action: sleep_form
    - active_loop: null
    - action: action_save_issue_profile
    - action: action_submit_issue_form
    - action: action_ask_focus_issue
    - action: action_update_personality




  # Intrusive thoughts form
- rule: Salva i dati del intrusive thoughts form
  condition:
    - active_loop: intrusive_thoughts_form
  steps:
    - action: intrusive_thoughts_form
    - active_loop: null
    - action: action_save_issue_profile
    - action: action_submit_issue_form
    - action: action_ask_focus_issue
    - action: action_update_personality



  # Addiction form
- rule: Salva i dati del addiction form
  condition:
    - active_loop: addiction_form
  steps:
    - action: addiction_form
    - active_loop: null
    - action: action_save_issue_profile
    - action: action_submit_issue_form
    - action: action_ask_focus_issue
    - action: action_update_personality




  # Nutrition form
- rule: Salva i dati del nutrition form
  condition:
    - active_loop: nutrition_form
  steps:
    - action: nutrition_form
    - active_loop: null
    - action: action_save_issue_profile
    - action: action_submit_issue_form
    - action: action_ask_focus_issue
    - action: action_update_personality




  # Motivation form
- rule: Salva i dati del motivation form
  condition:
    - active_loop: motivation_form
  steps:
    - action: motivation_form
    - active_loop: null
    - action: action_save_issue_profile
    - action: action_submit_issue_form
    - action: action_ask_focus_issue
    - action: action_update_personality


  # Self esteem form
- rule: Salva i dati del self esteem form
  condition:
    - active_loop: self_esteem_form
  steps:
    - action: self_esteem_form
    - active_loop: null
    - action: action_save_issue_profile
    - action: action_submit_issue_form
    - action: action_ask_focus_issue
    - action: action_update_personality

  # Lifestyle form
- rule: Salva i dati del lifestyle form
  condition:
    - active_loop: lifestyle_form
  steps:
    - action: lifestyle_form
    - active_loop: null
    - action: action_save_issue_profile
    - action: action_submit_issue_form
    - action: action_ask_focus_issue
    - action: action_update_personality



# - rule: Classify user health condition
#   steps:
#     - intent: inform_health_condition
#     - action: action_classify_user_health_condition

# - rule: Classify user health condition (good health)
#   steps:
#     - intent: inform_good_health
#     - action: action_classify_user_health_condition


# conversation rules

- rule: User refuses to provide information
  steps:
    - intent: reject
    - action: utter_ok_no_questions

- rule: Respond to thank you
  steps:
    - intent: thank_you
    - action: utter_you_are_welcome

- rule: Respond_to_ask_about_chatbot
  steps:
    - intent: ask_about_chatbot
    - action: utter_info

# custom action rules

- rule: Extract user name 
  steps:
    - intent: user_name
    - action: action_extract_name

- rule: Classify user occupation
  steps:
    - intent: inform_occupation
    - action: action_classify_user_occupation

- rule: Classify user interests
  steps:
    - intent: inform_interests
    - action: action_classify_user_interests


- rule: LLM fallback if not classifiable
  steps:
    - intent: nlu_fallback
    - action: action_llm_fallback


- rule: start profiling after form
  condition:    
    - active_loop: null
  steps:
    - intent: user_problem
    - action: action_extract_issues
    - action: action_ask_focus_issue

- rule: User provide current issue
  steps:
    - intent: user_main_issue
    - action: action_set_current_issue
